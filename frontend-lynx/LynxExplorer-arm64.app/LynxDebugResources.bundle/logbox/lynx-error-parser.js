(()=>{"use strict";var e={},r={};function o(n){var t=r[n];if(void 0!==t)return t.exports;var l=r[n]={exports:{}};return e[n](l,l.exports,o),l.exports}function n(e,r,o){return r in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function t(e){if(!e)return null;try{return JSON.parse(e)}catch(e){return console.log("failed to parse string to json object, error:",e),null}}o.rv=()=>"1.3.6",o.ruid="bundler=rspack@1.3.6";class l{async parse(e){let r={code:e.error_code,level:e.level},o=e.error,n=r.code??0;if(2!==(n=Math.floor(n/100)))return null;let l=t(o);if(!l||!l.rawError||!l.rawError.stack)return null;r.stack=l.rawError.stack;let i=window.logBoxCore.parseStack(l.rawError);i.length>15&&(i=i.slice(0,15));let s=await window.logBoxCore.map(i,3,{getResource:async e=>await window.logBoxCore.queryResource(e)??""});return{contextSize:3,message:l.rawError.message,stackFrames:s,errorProps:r}}}class i{setResource(e,r){(!this.resourceMap.has(r)||this.resourceMap.get(r))&&this.resourceMap.set(r,e)}async getResource(e){return this.resourceMap.get(e)??""}constructor(){n(this,"resourceMap",void 0),this.resourceMap=new Map}}class s{async parse(e){let r={code:e.error_code,level:e.level},o=e.error;if(11!==Math.floor((r.code??0)/100))return null;let n=t(o),l=o;n&&n.rawError&&n.rawError.cause&&n.rawError.cause.cause&&(l=n.rawError.cause.cause);let i=this.extractErrorInfo(l);if(i.debugInfoUrl){let e=await window.logBoxCore.queryResource(i.debugInfoUrl);this.debugInfo.set("main-thread.js",e)}r.stack=i.stack;let s=window.logBoxCore.parseStack(i.stack);s.length>15&&(s=s.slice(0,15));let c={contextSize:3,message:i.message,stackFrames:s,errorProps:r},{frames:a,resourceProvider:u,callerInfo:f}=await this.getStackFramesInProduction(s);return c.message.includes("not a function")&&f&&(c.message=c.message+":"+f),c.stackFrames=await window.logBoxCore.map(a,3,u),c}extractErrorInfo(e){let[r,o]=e.split("template_debug_url:"),[n,t]=r.split("backtrace:");return{message:n,stack:t,debugInfoUrl:o}}getCallerInfo(e,r,o){if(!e||!r)return console.log("Failed to get caller info caused by invalid function id or pc index"),"";if(o){let n=o.find(r=>r.function_id==e);if(n&&n.pc2caller_info&&r in n.pc2caller_info)return n.pc2caller_info[r];console.log("Cannot find field pc2caller_info in debug info")}return console.log("Failed to get caller info"),""}async getStackFramesInProduction(e){let r=new i,o="",n=[];for(let l=0;l<e.length;l++){let i=e[l];i.fileName||(i.fileName="main-thread.js");let s=null;this.debugInfo.has(i.fileName)?s=this.debugInfo.get(i.fileName):(s=await window.logBoxCore.queryResource(i.fileName),this.debugInfo.set(i.fileName,s));let c=t(s);if(!c){console.log("Failed to parse main thread js error caused by invalid debug info"),n.push(i);continue}let{functionInfoList:a,functionSource:u}=this.getFunctionInfo(c,i.fileName);if(r.setResource(u??"",i.fileName),!a){n.push(i);continue}0===l&&(o=this.getCallerInfo(i.lineNumber,i.columnNumber,a));let f=i.lineNumber??-1,d=i.columnNumber??-1,g=a.find(e=>e.function_id===f);if(!g||-1===d){n.push(i);continue}if(g.line_col&&g.line_col.length>d){let e=g.line_col[d];i.lineNumber=e.line??i.lineNumber,i.columnNumber=e.column??i.columnNumber}else if(g.line_col_info&&g.line_col_info.line_col&&g.line_col_info.line_col.length>d){let e=g.line_col_info.line_col[d],r=e.line??-1,o=e.column??-1;0===r&&o>65536?(i.lineNumber=o>>16&65535,i.columnNumber=65535&o):r>0&&o>0&&(i.lineNumber=r,i.columnNumber=o)}n.push(i)}return Promise.resolve({frames:n,resourceProvider:r,callerInfo:o})}getFunctionInfo(e,r){let o=null;for(let n in e)if(r.includes(n)){o=e[n];break}null===o&&(e.lepusNG_debug_info?o=e.lepusNG_debug_info:e.lepus_debug_info&&(o=e.lepus_debug_info));let n=null,t=null;return o&&(n=o.function_info,o.function_source?t=o.function_source:n&&n.length>0&&(t=n[0].function_source)),t||console.log("getFunctionInfo: cannot find function source in debug info"),n||console.log("getFunctionInfo: cannot find function info in debug info"),{functionInfoList:n,functionSource:t}}constructor(){n(this,"debugInfo",void 0),this.debugInfo=new Map}}class c{async parse(e){if(!(null==e?void 0:e.error))return null;let r={code:e.sub_code,level:e.level,stack:e.error_stack,fixSuggestion:e.fix_suggestion},o={};return e.root_cause&&(o.root_cause=e.root_cause),e.context&&Object.keys(e.context).forEach(r=>{o[r.slice(13,r.length)]=e.context[r]}),r.criticalInfo=o,{message:e.error,contextSize:3,errorProps:r}}}function a(e){return{message:e,contextSize:3,rawErrorText:e,errorProps:{code:-1}}}"undefined"!=typeof window&&window.logBoxCore&&window.logBoxCore.registerErrorParser("lynx",new class{async parse(e){let r=t(e);if(!r)return console.warn("Failed to parse error, the raw data is:",e),a(e);for(let o of this.childParsers){let n;try{n=await o.parse(r)}catch(e){console.warn("Exception encountered while parsing raw error:",e)}if(n)return{...n,rawErrorText:e}}return a(e)}constructor(){n(this,"childParsers",[]),this.childParsers.push(new l),this.childParsers.push(new s),this.childParsers.push(new c)}})})();